{% extends "layout.html" %}
{% set title = college.college_acronym %}

{% block content %}
<div class="flex">
    {% include "sidebar.html" %}
    <main class="ml-[260px] p-6 mt-[60px] text-gray-300">
        <h2 class="text-3xl font-bold text-white mb-4">{{ college.college_name }}</h2>
        <a href="{{ url_for('campus_page', campus_acronym=campus.campus_acronym) }}"
           class="mb-4 inline-block px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
            Back to Campus
        </a>

        {% if user.userType == 'admin' %}
        <!-- Admin View: Display grids for various user roles -->
        <h3 class="text-2xl font-bold text-white mb-4">Campus Directors</h3>
        <div class="grid grid-cols-2 gap-6">
            {% set directors = users | selectattr("userType", "equalto", "Campus Director") | list %}
            {% if directors %}
            {% for director in directors %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                 onclick="confirmDeleteUser({{ director.id }})">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ director.firstName }} {{ director.lastName }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400 col-span-2">No Campus Directors found for this college.</p>
            {% endif %}
        </div>

        <h3 class="text-2xl font-bold text-white mb-4">Vice Chancellors</h3>
        <div class="grid grid-cols-2 gap-6">
            {% set chancellors = users | selectattr("userType", "equalto", "Vice Chancellor") | list %}
            {% if chancellors %}
            {% for chancellor in chancellors %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                 onclick="confirmDeleteUser({{ chancellor.id }})">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ chancellor.firstName }} {{ chancellor.lastName }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400 col-span-2">No Vice Chancellors found for this college.</p>
            {% endif %}
        </div>

        <h3 class="text-2xl font-bold text-white mb-4">Deans</h3>
        <div class="grid grid-cols-2 gap-6">
            {% set deans = users | selectattr("userType", "equalto", "Dean") | list %}
            {% if deans %}
            {% for dean in deans %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                 onclick="confirmDeleteUser({{ dean.id }})">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ dean.firstName }} {{ dean.lastName }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400 col-span-2">No Deans found for this college.</p>
            {% endif %}
        </div>

        <h3 class="text-2xl font-bold text-white mb-4">Teachers</h3>
        <div class="grid grid-cols-2 gap-6">
            {% set teachers = users | selectattr("userType", "equalto", "Teacher") | list %}
            {% if teachers %}
            {% for teacher in teachers %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                 onclick="confirmDeleteUser({{ teacher.id }})">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ teacher.firstName }} {{ teacher.lastName }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400 col-span-2">No Teachers found for this college.</p>
            {% endif %}
        </div>

        {% elif user.userType == 'Dean' %}
        <!-- Dean View: Show only Teachers in this college -->
        <h3 class="text-2xl font-bold text-white mb-4 mt-6">Teachers</h3>
        <div class="grid grid-cols-2 gap-6">
            {% set teachers = users | selectattr("userType", "equalto", "Teacher") | list %}
            {% if teachers %}
            {% for teacher in teachers %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                 onclick="redirectToUploadHistory('{{ teacher.uName }}', '{{ college.college_acronym }}')">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ teacher.firstName }} {{ teacher.lastName }}</p>
            </div>

            {% endfor %}
            {% else %}
            <p class="text-gray-400 col-span-2">No Teachers found for this college.</p>
            {% endif %}
        </div>
        {% else %}
        <script>
        window.location.href = "{{ url_for('dashboard') }}";
        </script>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block scripts %}
  {% if user.userType == 'admin' %}
<script>
  function confirmDeleteUser(userId) {
    if (confirm("Are you sure you want to delete this account? This action cannot be undone.")) {
      let deleteUrl = "{{ url_for('delete_teacher', teacher_id=user.id) }}";
      deleteUrl = deleteUrl.replace('user_id_placeholder', userId);
      fetch(deleteUrl, { method: 'POST' })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            location.reload();
          }
        })
        .catch(error => {
          console.error("Error deleting account:", error);
        });
    }
  }
</script>
  {% elif user.userType == 'Dean' %}
    <script>
        function redirectToUploadHistory(uName, collegeAcronym) {
            window.location.href = "{{ url_for('uploadHistory') }}?teacher=" + encodeURIComponent(uName) + "&college=" + encodeURIComponent(collegeAcronym);
        }
    </script>
  {% endif %}
{% endblock %}
