{% extends "layout.html" %}
{% set title = "Register" %}
{% set year = 2025 %}

{% block content %}
<div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
    <div class="relative w-full max-w-md bg-white/10 backdrop-blur-lg p-8 rounded-xl shadow-lg border border-white/20">
        <h2 class="text-3xl font-extrabold text-white text-center">Create an Account</h2>
        <p class="text-gray-300 text-center mt-2">Join us today</p>

        <form id="registerForm" method="POST" action="{{ url_for('register') }}" class="mt-6 space-y-4">
            <div class="relative">
                <label for="userType" class="block text-sm font-semibold text-gray-200">Position</label>
                <select id="userType" name="userType"
                        class="mt-1 w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-lg shadow-lg text-gray-300
               focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition duration-300 ease-in-out
               hover:bg-gray-800 hover:border-yellow-500 hover:text-white">
                    <option value="Unselected">Select your position</option>
                    <option value="Campus Director">Campus Director</option>
                    <option value="Vice Chancellor">Vice Chancellor</option>
                    <option value="Dean">Dean</option>
                    <option value="Teacher">Teacher</option>
                </select>
            </div>

            <div class="relative">
                <label for="firstName" class="block text-sm font-medium text-gray-300">First Name</label>
                <input type="text" id="firstName" name="firstName"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Enter first name" required>
            </div>

            <div class="relative">
                <label for="lastName" class="block text-sm font-medium text-gray-300">Last Name</label>
                <input type="text" id="lastName" name="lastName"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Enter last name" required>
            </div>

            <div class="relative">
                <label for="uName" class="block text-sm font-medium text-gray-300">Username</label>
                <input type="text" id="uName" name="uName"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Choose a username" required>
            </div>

            <div class="relative">
                <label for="pWord" class="block text-sm font-medium text-gray-300">Password</label>
                <input type="password" id="pWord" name="pWord"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Choose a password" required>
            </div>

            <div class="relative">
                <label for="campus" class="block text-sm font-medium text-gray-300">Campus</label>
                <input type="text" id="campus" name="campus"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Enter campus" required>
            </div>

            <div class="relative hidden" id="collegeGroup">
                <label for="college" class="block text-sm font-medium text-gray-300">College</label>
                <input type="text" id="college" name="college"
                       class="mt-1 w-full px-4 py-2 bg-transparent border border-gray-500 rounded-lg shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-white" placeholder="Enter college">
            </div>

            <button type="submit" id="registerButton"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg
                           hover:bg-blue-700 hover:scale-105 transition-all duration-300 ease-in-out shadow-lg">
                Register
            </button>
        </form>

        <p class="mt-4 text-center text-gray-400">
            Already have an account?
            <a href="{{ url_for('login') }}" class="text-blue-400 hover:text-blue-500 transition">Login</a>
        </p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userType = document.getElementById("userType");
        const collegeGroup = document.getElementById("collegeGroup");
        const uNameInput = document.getElementById("uName");
        const registerForm = document.getElementById("registerForm");

        // Create validation messages
        const usernameError = document.createElement("span");
        usernameError.className = "text-red-500 font-bold text-sm mt-1";
        uNameInput.parentNode.insertBefore(usernameError, uNameInput.nextSibling);

        const positionError = document.createElement("span");
        positionError.className = "text-red-500 font-bold text-sm mt-1 hidden";
        positionError.textContent = "Please select a valid position.";
        userType.parentNode.insertBefore(positionError, userType.nextSibling);

        userType.addEventListener("change", function () {
            if (this.value === "Dean" || this.value === "Teacher") {
                collegeGroup.classList.remove("hidden");
            } else {
                collegeGroup.classList.add("hidden");
            }

            if (this.value !== "Unselected") {
                positionError.classList.add("hidden");
            }
        });

        registerForm.addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent immediate submission

            let formValid = true;

            // Check if position is selected
            if (userType.value === "Unselected") {
                positionError.classList.remove("hidden");
                formValid = false;
            }

            // Check if username is available
            fetch("{{ url_for('check_username') }}", {
                method: "POST",
                body: JSON.stringify({ uName: uNameInput.value.trim() }),
                headers: { "Content-Type": "application/json" }
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    usernameError.textContent = "Username is already taken. Please choose another.";
                    formValid = false;
                } else {
                    usernameError.textContent = "";
                }

                if (formValid) {
                    registerForm.submit(); // Submit the form only if all checks pass
                }
            })
            .catch(error => console.error("Error checking username:", error));
        });
    });
</script>




{% endblock %}
