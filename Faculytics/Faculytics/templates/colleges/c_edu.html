<!-- c_edu.html -->
{% extends "layout.html" %}
{% set title = "College of Education" %}

{% block content %}
<div class="flex">
    {% include "sidebar.html" %}
    <main class="ml-[260px] p-6 mt-[60px] text-gray-300">
        <h2 class="text-3xl font-bold text-white mb-4">College of Education</h2>

        <!-- Back to Campus button -->
        <!-- Retrieve the campus code from the query parameter, defaulting to "ucm" if not provided #} -->
        {% set campus_code = request.args.get('campus', 'ucm') %}
        <a href="{{ url_for(campus_code) }}" class="mb-4 inline-block px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
            Back to Campus
        </a>

        <!-- Admin View -->
        {% if user.userType == 'admin' %}
        {% for role in ["Campus Director", "Vice Chancellor", "Dean", "Teacher"] %}
        <div class="mb-6">
            <h3 class="text-2xl font-bold text-white mb-4">{{ role }}s</h3>
            <div class="grid grid-cols-2 gap-6">
                {% set count = 0 %}
                {% for u in users if u.userType == role %}
                {% set count = count + 1 %}
                <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600 cursor-pointer"
                     onclick="confirmDeleteTeacher({{ u.id }})">
                    <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                    <p class="text-white text-lg font-bold text-center">{{ u.firstName }} {{ u.lastName }}</p>
                </div>
                {% endfor %}
                {% if count == 0 %}
                <p class="text-gray-400 col-span-2">No {{ role }} found for this college.</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <!-- Non-admin view: show teachers in a grid -->
        <div class="grid grid-cols-2 gap-6">
            {% for u in users %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ u.firstName }} {{ u.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No users found for this college.</p>
            {% endfor %}
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block scripts %}
    {% if user.userType == 'admin' %}
<script>
        function confirmDeleteTeacher(teacherId) {
            console.log("confirmDeleteTeacher called with teacherId:", teacherId);
            if (confirm("Are you sure you want to delete this account? This action cannot be undone.")) {
                let deleteUrl = "{{ url_for('delete_teacher', teacher_id=0) }}".replace('0', teacherId);
                console.log("Deleting account at:", deleteUrl);
                fetch(deleteUrl, { method: 'POST' })
                .then(response => {
                    if(response.redirected){
                        window.location.href = response.url;
                    } else {
                        location.reload();
                    }
                })
                .catch(error => {
                    console.error("Error deleting account:", error);
                });
            }
        }
</script>
    {% endif %}
{% endblock %}