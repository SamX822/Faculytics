<!-- cas.html -->
{% extends "layout.html" %}
{% set title = "College of Arts and Sciences" %}

{% block content %}
<div class="flex">
    {% include "sidebar.html" %}
    <main class="ml-[260px] p-6 mt-[60px] text-gray-300">
        <h2 class="text-3xl font-bold text-white mb-4">College of Arts and Sciences</h2>

        {# Retrieve the campus code from the query parameter, defaulting to "ucm" if not provided #}
        {% set campus_code = request.args.get('campus', 'ucm') %}
        <a href="{{ url_for(campus_code) }}" class="mb-4 inline-block px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
            Back to Campus
        </a>

        {% if user.userType == 'admin' %}

        <!-- Campus Directors Grid -->
        <h3 class="text-2xl font-bold text-white mb-4">Campus Directors</h3>
        <div class="grid grid-cols-2 gap-6">
            {% for director in users if director.userType == "Campus Director" %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600
                    {% if user.userType == 'admin' %} cursor-pointer {% endif %}"
                 {% if user.userType =='admin' %}
                 onclick="confirmDeleteUser({{ director.id }})"
                 {% endif %}>
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ director.firstName }} {{ director.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No Campus Directors found for this college.</p>
            {% endfor %}
        </div>

        <!-- Vice Chancellors Grid -->
        <h3 class="text-2xl font-bold text-white mb-4 mt-6">Vice Chancellors</h3>
        <div class="grid grid-cols-2 gap-6">
            {% for chancellor in users if chancellor.userType == "Vice Chancellor" %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600
                    {% if user.userType == 'admin' %} cursor-pointer {% endif %}"
                 {% if user.userType =='admin' %}
                 onclick="confirmDeleteUser({{ chancellor.id }})"
                 {% endif %}>
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ chancellor.firstName }} {{ chancellor.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No Vice Chancellors found for this college.</p>
            {% endfor %}
        </div>

        <!-- Deans Grid -->
        <h3 class="text-2xl font-bold text-white mb-4 mt-6">Deans</h3>
        <div class="grid grid-cols-2 gap-6">
            {% for dean in users if dean.userType == "Dean" %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600
                    {% if user.userType == 'admin' %} cursor-pointer {% endif %}"
                 {% if user.userType =='admin' %}
                 onclick="confirmDeleteUser({{ dean.id }})"
                 {% endif %}>
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ dean.firstName }} {{ dean.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No Deans found for this college.</p>
            {% endfor %}
        </div>

        <!-- Teachers Grid -->
        <h3 class="text-2xl font-bold text-white mb-4 mt-6">Teachers</h3>
        <div class="grid grid-cols-2 gap-6">
            {% for teacher in users if teacher.userType == "Teacher" %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600
                    {% if user.userType == 'admin' %} cursor-pointer {% endif %}"
                 {% if user.userType =='admin' %}
                 onclick="confirmDeleteUser({{ teacher.id }})"
                 {% endif %}>
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ teacher.firstName }} {{ teacher.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No Teachers found for this college.</p>
            {% endfor %}
        </div>

        {% elif user.userType == 'Dean' %}

        <!-- Dean view: show all Teacher in a grid -->
        <h3 class="text-2xl font-bold text-white mb-4 mt-6">Teachers</h3>
        <div class="grid grid-cols-2 gap-6">
            {% for teacher in users if teacher.userType == "Teacher" %}
            <div class="bg-gray-700 p-4 rounded-lg flex flex-col items-center transition hover:bg-gray-600">
                <div class="w-20 h-20 bg-white rounded-full mb-4"></div>
                <p class="text-white text-lg font-bold text-center">{{ teacher.firstName }} {{ teacher.lastName }}</p>
            </div>
            {% else %}
            <p class="text-gray-400 col-span-2">No Teachers found for this college.</p>
            {% endfor %}
        </div>


        {% else %}

        {# Redirect Unauthorized Users (not Admin or Dean) to Dashboard #}
        <script>
            window.location.href = "{{ url_for('dashboard') }}";
        </script>

        {% endif %}
    </main>
</div>
{% endblock %}

{% block scripts %}
    {% if user.userType == 'admin' %}
<script>
            function confirmDeleteUser(userId) {
                if (confirm("Are you sure you want to delete this account? This action cannot be undone.")) {
                    let deleteUrl = "{{ url_for('delete_teacher', teacher_id=0) }}".replace('0', userId);
                    fetch(deleteUrl, { method: 'POST' })
                        .then(response => {
                            if(response.redirected){
                                window.location.href = response.url;
                            } else {
                                location.reload();
                            }
                        })
                        .catch(error => {
                            console.error("Error deleting account:", error);
                        });
                }
            }
</script>
    {% endif %}
{% endblock %}